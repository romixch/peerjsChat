<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Peer JS Chat</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      
            
      <h1>Peer JS Chat</h1>
      
      <form>
        <div class="form-group">
          <label for="host">PeerJS Host</label>
          <input id="host" value="dev.datagnan.com" class="form-control"/>
        </div>
        <div class="form-group">
          <label for="id">PeerJS Port</label>
          <input id="port" value="443" class="form-control"/>
        </div>
        <div class="form-group">
          <label for="path">PeerJS Path</label>
          <input id="path" value="/peerjs" class="form-control"/>
        </div>
        <div class="form-group">
          <input id="ssl" type="checkbox" checked="checked"/>
          <label for="ssl">Connect with SSL</label>
        </div>
        
        <button id="connectToPeerJS" class="btn btn-default">Connect to PeerJS server</button>
      </form>
      <br/><br/>
      <form>
        <div class="form-group">
          <label for="myid">My id</label>
          <input id="myid" class="form-control" />
        </div>
        <div class="form-group">
          <label for="otherid">Other id</label>
          <input id="otherid" class="form-control"/>
        </div>
        
        <button id="connectToPeer" class="btn btn-default">Connect with peer</button><br/>
        Connected with: <div id="connectedWith">Not yet connected!</div><br/>
        </form>
        <form>
          <div class="form-group">
            <label for="message">Message</label>
            <input id="message" class="form-control" />
          </div>
          <button id="post" class="btn btn-default">Post message</button>
        
        <p id="chat"></p>
      </form>
    
    </div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script src="http://cdn.peerjs.com/0.3/peer.js"></script>
    <script type="text/javascript" src="js/jquery.qrcode.min.js"></script>
    <script lang="JavaScript">
      $('#connectToPeerJS').on('click', function() {
        var peer = new Peer({
			host: $('#host').val(),
			port: $('#port').val(),
			path: $('#path').val(),
			secure: $('#ssl').is(':checked')
		});
        peer.on('open', function(id) {
          $('#myid').val(id);
          
          $('#connectToPeer').on('click', function() {
            var otherid = $('#otherid').val();
            var conn = peer.connect(otherid);
            attachConnectionToChat(conn);
          });
          
          peer.on('connection', function(conn) {
            attachConnectionToChat(conn);
          });
        });
        return false;
      });
      
      var attachConnectionToChat = function(conn) {
        var connectedWith = $('#connectedWith');
        connectedWith.text(conn.peer);
        
        var chatElem = $('#chat');
        
        conn.on('data', function(data) {
          chatElem.append('<div>' + conn.peer + ': ' + data + '</div>');
        });
        
        $('#post').on('click', function() {
          var message = $('#message');
          conn.send(message.val());
          chatElem.append('<div>me: ' + message.val() + '</div>');
          $('#message').val('');
        });
      };
    </script>
  </body>
</html>